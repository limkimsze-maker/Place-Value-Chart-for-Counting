<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Place Value ‚Äî Polypad Blocks + Discs</title>
<style>
  :root{
    --bg:#ffffff;
    --ink:#0f172a;
    --muted:#64748b;
    --line:#e2e8f0;

    --S: 13px;

    /* place colors (header + panel tint) */
    --c-tm-h:#0b2a6a; --c-tm-t:#e6efff; /* ten millions (very dark blue) */
    --c-m-h:#7c3aed;  --c-m-t:#f3e8ff; /* millions */
    --c-ht-h:#2563eb; --c-ht-t:#e0f2fe; /* hundred thousands */
    --c-tt-h:#ef4444; --c-tt-t:#ffe4e6; /* ten thousands */
    --c-th-h:#8b5cf6; --c-th-t:#ede9fe; /* thousands */
    --c-h-h:#ec4899;  --c-h-t:#ffe4f1; /* hundreds */
    --c-t-h:#f59e0b;  --c-t-t:#fff1db; /* tens */
    --c-o-h:#06b6d4;  --c-o-t:#dff7ff; /* ones */
  }

  *{ box-sizing:border-box; }
  html, body{ height: 100%; }
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: var(--bg);
    color: var(--ink);
    overflow: hidden;
  }

  .topbar{
    height: 62px;
    position: sticky;
    top: 0;
    z-index: 10;
    background: rgba(255,255,255,.92);
    backdrop-filter: blur(8px);
    border-bottom: 1px solid var(--line);
    padding: 10px 14px;
    display:flex;
    align-items:center;
    justify-content: space-between;
    gap: 10px;
  }
  .title{
    font-weight: 1000;
    letter-spacing: .2px;
    display:flex;
    align-items: baseline;
    gap: 10px;
    min-width: 260px;
  }
  .title .big{ font-size: 18px; }
  .title .small{ font-size: 12px; color: var(--muted); font-weight: 900; }

  .actions{ display:flex; gap: 10px; align-items:center; }
  .pill{
    border: 1px solid var(--line);
    background:#fff;
    border-radius: 999px;
    padding: 8px 10px;
    display:flex;
    gap: 8px;
    align-items:center;
    font-size: 12px;
    font-weight: 1000;
    color: var(--muted);
    white-space: nowrap;
  }
  .pill strong{ color: var(--ink); }
  .iconBtn{
    width: 40px; height: 40px;
    border-radius: 12px;
    border: 1px solid var(--line);
    background:#fff;
    cursor:pointer;
    font-size: 18px;
    display:grid;
    place-items:center;
  }

  .wrap{
    height: calc(100vh - 62px);
    max-width: 1300px;
    margin: 0 auto;
    padding: 12px 14px 10px;
    display:flex;
    flex-direction: column;
    gap: 12px;
    overflow: hidden;
  }

  .panelGrid{
    flex: 1 1 auto;
    display:grid;
    gap: 14px;
    align-content: stretch;
    overflow: hidden;
    grid-template-columns: repeat(var(--cols, 3), 1fr);
    min-height: 0;
  }
  .pvPanel{
    border-radius: 24px;
    padding: 14px;
    box-shadow: 0 14px 26px rgba(0,0,0,.10);
    display:flex;
    flex-direction: column;
    overflow: hidden;
    min-width: 0;
  }
  .pvLabel{
    font-weight: 1000;
    font-size: 18px;
    letter-spacing: .2px;
    margin-bottom: 10px;
    line-height: 1.1;
  }
  .pvStage{
    flex: 1 1 auto;
    display:flex;
    align-items:center;
    justify-content:center;
    overflow: hidden;
    min-height: 0;
  }
  .fitBox{
    transform-origin: center bottom;
    will-change: transform;
  }

  .pile{
    width: 100%;
    display:flex;
    align-items: flex-end;
    justify-content: center;
    flex-wrap: wrap;
    gap: calc(var(--S) * 0.45);
    padding: 2px;
  }
  .pile.rods{
    display:grid;
    grid-template-columns: repeat(4, max-content);
    gap: calc(var(--S) * 0.45);
    justify-content:center;
    align-items:end;
  }
  .pile.ones{
    display:grid;
    grid-template-columns: repeat(5, max-content);
    gap: calc(var(--S) * 0.40);
    justify-content:center;
    align-items:end;
  }
  .pile.flats{
    display:grid;
    grid-template-columns: repeat(2, max-content);
    gap: calc(var(--S) * 0.55);
    justify-content:center;
    align-items:end;
  }
  .pile.cubes{
    display:grid;
    grid-template-columns: repeat(3, max-content);
    gap: calc(var(--S) * 0.55);
    justify-content:center;
    align-items:end;
  }

  /* blocks */
  .blk{ display:block; }
  .blk svg{ width: 100%; height: 100%; display:block; }

  /* sized off your uploaded SVG viewBoxes */
  .blk.one      { width: calc(var(--S) * 3.2);  height: calc(var(--S) * 3.6); }
  .blk.ten      { width: calc(var(--S) * 2.4);  height: calc(var(--S) * 12.0);}
  .blk.hundred  { width: calc(var(--S) * 10.0); height: calc(var(--S) * 6.5); }
  .blk.thousand { width: calc(var(--S) * 7.8);  height: calc(var(--S) * 9.0); }

  /* discs */
  .discStack{
    display:flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content:center;
    align-items:center;
    gap: calc(var(--S) * 0.55);
    padding: 4px 0;
  }
  .disc{
    width:  calc(var(--S) * 3.6);
    height: calc(var(--S) * 3.6);
    border-radius: 999px;
    display:flex;
    align-items:center;
    justify-content:center;

    font-weight: 1000;
    font-size: calc(var(--S) * 0.95);
    color: rgba(0,0,0,.78);
    text-shadow: 0 1px 0 rgba(255,255,255,.35);

    background: var(--disc-fill);
    border: 3px solid var(--disc-rim);

    box-shadow:
      0 10px 18px rgba(0,0,0,.16),
      inset 0 -6px 10px rgba(0,0,0,.10);
    position: relative;
    user-select:none;
  }
  .disc::before{
    content:"";
    position:absolute;
    inset: 4px;
    border-radius: 999px;
    background: radial-gradient(circle at 30% 25%,
      rgba(255,255,255,.55) 0%,
      rgba(255,255,255,.18) 28%,
      rgba(255,255,255,0) 60%);
    pointer-events:none;
  }
  .disc::after{
    content:"";
    position:absolute;
    inset: 8px;
    border-radius: 999px;
    box-shadow: inset 0 2px 0 rgba(255,255,255,.25);
    pointer-events:none;
  }

  /* cards + words + expanded */
  .cardsWrap{
    flex: 0 0 auto;
    border-radius: 22px;
    overflow:hidden;
    box-shadow: 0 14px 26px rgba(0,0,0,.10);
    border: 1px solid var(--line);
    background:#fff;
    padding: 12px 12px 10px;
  }
  .cardsTop{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 10px;
    margin-bottom: 8px;
  }
  .cardsTop .h{
    font-weight: 1000;
    letter-spacing:.2px;
    font-size: 14px;
  }
  .segMini{
    display:flex;
    border: 1px solid var(--line);
    border-radius: 999px;
    overflow:hidden;
    background:#fff;
  }
  .segMini button{
    border:0;
    background:transparent;
    padding: 7px 10px;
    font-weight: 1000;
    font-size: 12px;
    color: var(--muted);
    cursor:pointer;
    white-space:nowrap;
  }
  .segMini button.active{
    background:#0f172a;
    color:#fff;
  }
  .btn{
    padding: 10px 12px;
    border: 1px solid var(--line);
    border-radius: 14px;
    background:#fff;
    cursor:pointer;
    font-weight: 1000;
    font-size: 13px;
  }
  .btn.primary{ background:#0f172a; color:#fff; border-color:#0f172a; }

  .cardsArea{
    display:grid;
    grid-template-rows: auto auto;
    gap: 10px;
    align-items:center;
  }
  .apartRow{
    display:flex;
    gap: 14px;
    justify-content: space-evenly;
    align-items:flex-start;
    flex-wrap: wrap;
    padding: 4px 2px 0;
  }
  .apartItem{
    min-width: 140px;
    display:flex;
    flex-direction: column;
    align-items:center;
    gap: 6px;
  }
  .apartItem .cap{
    font-weight: 1000;
    font-size: 14px;
    color:#000;
    letter-spacing:.2px;
    text-align:center;
  }
  .pvCard{
    width: 160px;
    height: 54px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius: 10px;
    position: relative;
    border: 2px solid rgba(0,0,0,.10);
    box-shadow: 0 10px 18px rgba(0,0,0,.14);
    clip-path: polygon(0 0, calc(100% - 16px) 0, 100% 16px, 100% 100%, 0 100%);

    --pv-fs: 26px;
    --pv-gap: 14px;
  }
  .pvCard .digits{
    display:flex;
    justify-content:center;
    align-items:center;
    flex-wrap: nowrap;
    gap: var(--pv-gap);
    font-weight: 1000;
    font-size: var(--pv-fs);
    color:#000;
    user-select:none;
    letter-spacing: 0;
    transform: none;
    white-space: nowrap;
  }
  .pvCard{ --pv-minw: 0.9em; } /* ‚úÖ default */

.pvCard .digits span{
  display:inline-block;
  min-width: var(--pv-minw); /* ‚úÖ adjustable per card */
  text-align:center;
}


  .togetherRow{
    display:flex;
    justify-content:center;
    padding: 0 2px;
  }
  .joinCard{
    display:flex;
    border-radius: 12px;
    overflow:hidden;
    box-shadow: 0 10px 18px rgba(0,0,0,.14);
    border: 2px solid rgba(0,0,0,.10);
  }
  .joinSeg{
    width: 56px;
    height: 64px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight: 1000;
    font-size: 28px;
    color:#000;
    user-select:none;
  }
  .joinSeg:last-child{
    clip-path: polygon(0 0, calc(100% - 16px) 0, 100% 16px, 100% 100%, 0 100%);
  }
  .wordsLine{
    margin-top: 8px;
    text-align:center;
    font-weight: 1000;
    font-size: 22px;
    letter-spacing:.2px;
    color:#000;
  }
  .expLine{
    margin-top: 8px;
    background:#e9f3f2;
    border: 1px solid #d6e7e6;
    border-radius: 18px;
    padding: 10px 12px;
    text-align:center;
    font-weight: 1000;
    font-size: 34px;
    letter-spacing:.2px;
    color:#000;
  }
  .expLine small{
    display:block;
    margin-top: 4px;
    font-size: 12px;
    color: var(--muted);
    font-weight: 900;
  }

  /* chart */
  .chartWrap{
    flex: 0 0 auto;
    height: 150px;
    border-radius: 22px;
    overflow:hidden;
    box-shadow: 0 14px 26px rgba(0,0,0,.10);
    border: 1px solid var(--line);
  }
  .chartHead, .chartDigits{ display:flex; height: 50%; }
  .chartHead .cell{
    flex:1;
    padding: 12px 8px;
    text-align:center;
    font-weight: 1000;
    font-size: 22px;
    color:#fff;
    letter-spacing:.2px;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .chartDigits{
    background:#fff;
    border-top: 1px solid var(--line);
  }
  .chartDigits .cell{
    flex:1;
    padding: 10px 8px;
    text-align:center;
    font-weight: 1000;
    font-size: 38px;
    color:#000;
    border-right: 1px solid var(--line);
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .chartDigits .cell:last-child{ border-right:0; }

  /* drawer */
  .drawerBackdrop{
    position: fixed;
    inset: 0;
    background: rgba(15,23,42,.35);
    display:none;
    z-index: 20;
  }
  .drawer{
    position: fixed;
    right: 0;
    top: 0;
    height: 100%;
    width: min(420px, 92vw);
    background: #fff;
    border-left: 1px solid var(--line);
    box-shadow: -18px 0 40px rgba(0,0,0,.20);
    transform: translateX(100%);
    transition: transform .22s ease;
    z-index: 21;
    display:flex;
    flex-direction: column;
  }
  .drawer.open{ transform: translateX(0); }
  .drawerBackdrop.open{ display:block; }
  .drawerTop{
    padding: 12px 14px;
    border-bottom: 1px solid var(--line);
    display:flex;
    align-items:center;
    justify-content: space-between;
    gap: 10px;
  }
  .drawerTop .h{ font-weight: 1000; letter-spacing:.2px; }
  .drawerBody{
    padding: 14px;
    overflow:auto;
    display:flex;
    flex-direction: column;
    gap: 12px;
  }
  .field label{
    font-size: 12px;
    font-weight: 900;
    color: var(--muted);
    display:block;
    margin-bottom: 6px;
  }
  input[type="number"]{
    width:100%;
    padding: 10px 10px;
    border: 1px solid var(--line);
    border-radius: 14px;
    font-size: 14px;
    outline:none;
  }
  input[type="range"]{ width:100%; }

  .seg{
    display:flex;
    border: 1px solid var(--line);
    background:#fff;
    border-radius: 14px;
    overflow:hidden;
  }
  .seg button{
    flex:1;
    padding: 10px 10px;
    border:0;
    background: transparent;
    cursor:pointer;
    font-weight: 1000;
    font-size: 13px;
    color: var(--muted);
  }
  .seg button.active{
    background:#0f172a;
    color:#fff;
  }
  .seg button:disabled{ opacity:.45; cursor:not-allowed; }

  .btnRow{ display:flex; gap:10px; flex-wrap:wrap; }

  .note{
    font-size: 12px;
    color: var(--muted);
    line-height: 1.35;
    padding: 10px 12px;
    border: 1px dashed #cbd5e1;
    border-radius: 14px;
    background:#f8fafc;
  }

  .toast{
    position: fixed;
    left: 50%;
    bottom: 16px;
    transform: translateX(-50%);
    background: rgba(15,23,42,.92);
    color:#fff;
    padding: 10px 12px;
    border-radius: 14px;
    font-size: 12px;
    font-weight: 900;
    letter-spacing:.2px;
    z-index: 30;
    display:none;
    max-width: min(520px, 92vw);
    text-align:center;
  }

  .credit{
    font-size: 12px;
    color: var(--muted);
    text-align:right;
    padding-top: 2px;
  }

  @media (max-width: 980px){
    .wordsLine{ font-size: 18px; }
    .expLine{ font-size: 28px; }
    .pvCard{ width: 150px; }
  }
  @media (max-width: 860px){
    .panelGrid{ grid-template-columns: repeat(2, 1fr); }
    .chartWrap{ height: 140px; }
    .chartHead .cell{ font-size: 18px; }
    .chartDigits .cell{ font-size: 34px; }
  }
  @media (max-width: 520px){
    .panelGrid{ grid-template-columns: 1fr; }
    .expLine{ font-size: 24px; }
  }
</style>
</head>
<body>

  <div class="topbar">
    <div class="title">
      <span class="big">Place Value</span>
      <span class="small" id="modeBadge">Auto</span>
    </div>

    <div class="actions">
      <div class="pill" style="display:none;"><span>Number:</span><strong id="numRead">0</strong></div>
      <div class="pill"><span>Mode:</span><strong id="modeRead">Blocks</strong></div>
      <button class="iconBtn" id="toggleChart" title="Hide/Show Chart">üìä</button>
      <button class="iconBtn" id="openSettings" title="Settings">‚öôÔ∏è</button>

    </div>
  </div>

  <div class="wrap">
    <div class="panelGrid" id="panelGrid"></div>

    <div class="cardsWrap" id="cardsWrap">
      <div class="cardsTop">
        <div class="h">Place Value Cards</div>

        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
          <div class="segMini" aria-label="Cards view">
            <button id="btnApart" type="button" class="active">Put Apart</button>
            <button id="btnTogether" type="button">Placed Together</button>
          </div>

          <button id="btnToggleCards" type="button" class="btn" style="padding:7px 10px; border-radius:999px;">
            Hide Cards
          </button>
          <button id="btnToggleExpanded" type="button" class="btn" style="padding:7px 10px; border-radius:999px;">
            Hide Expanded
          </button>
        </div>
      </div>

      <div class="cardsArea" id="cardsArea">
        <div class="apartRow" id="cardsApart"></div>
        <div class="togetherRow" id="cardsTogether" style="display:none;"></div>
      </div>

      <div class="wordsLine" id="wordsLine"></div>
      <div class="expLine" id="expLine"><small></small></div>
    </div>

    <div class="chartWrap" id="chartWrap">
      <div class="chartHead" id="chartHead"></div>
      <div class="chartDigits" id="chartDigits"></div>
    </div>

    <div class="credit">Designed by Lim Kim Sze ¬© 2026</div>
  </div>

  <!-- Settings drawer -->
  <div class="drawerBackdrop" id="backdrop"></div>
  <aside class="drawer" id="drawer" aria-hidden="true">
    <div class="drawerTop">
      <div class="h">Settings</div>
      <button class="iconBtn" id="closeSettings" title="Close">‚úï</button>
    </div>
    <div class="drawerBody">
      <div class="field">
        <label>Number (0 to 10,000,000)</label>
        <input id="numInput" type="number" min="0" max="10000000" step="1" value="3241" />
      </div>

      <div class="field">
        <label>Mode</label>
        <div class="seg" role="tablist" aria-label="Mode selector">
          <button id="btnBlocks" type="button">Base Ten Blocks (&lt;10,000)</button>
          <button id="btnDiscs" type="button">Place Value Discs</button>
        </div>
      </div>

      <div class="field">
        <label>Size (base)</label>
        <input id="size" type="range" min="9" max="16" value="13" />
        <div class="note" id="sizeNote">
          Current base size: 13<br>
          Blocks/discs may auto-shrink further to fit panels.
        </div>
      </div>

      <div class="btnRow">
        <button class="btn primary" id="apply">Apply</button>
        <button class="btn" id="clear">Clear (0)</button>
        <button class="btn" id="randSmall">Random &lt;10,000</button>
        <button class="btn" id="randBig">Random ‚â§10,000,000</button>
      </div>

      <div class="note">
        Rules:
        <ul style="margin:8px 0 0 18px; padding:0;">
          <li>If number ‚â• 10,000 ‚Üí auto uses <b>Discs</b>.</li>
          <li>If number &lt; 10,000 ‚Üí default <b>Blocks</b> (unless you choose Discs).</li>
          <li>You can choose <b>Discs anytime</b>.</li>
        </ul>
      </div>
    </div>
  </aside>

  <div class="toast" id="toast"></div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const PLACES = [
    { key:"tm", name:"Ten Millions",      value:10000000, label:"10,000,000", head:"--c-tm-h", tint:"--c-tm-t" },
    { key:"m",  name:"Millions",          value:1000000,  label:"1,000,000",  head:"--c-m-h",  tint:"--c-m-t"  },
    { key:"ht", name:"Hundred Thousands", value:100000,   label:"100,000",    head:"--c-ht-h", tint:"--c-ht-t" },
    { key:"tt", name:"Ten Thousands",     value:10000,    label:"10,000",     head:"--c-tt-h", tint:"--c-tt-t" },
    { key:"th", name:"Thousands",         value:1000,     label:"1,000",      head:"--c-th-h", tint:"--c-th-t" },
    { key:"h",  name:"Hundreds",          value:100,      label:"100",        head:"--c-h-h",  tint:"--c-h-t"  },
    { key:"t",  name:"Tens",              value:10,       label:"10",         head:"--c-t-h",  tint:"--c-t-t"  },
    { key:"o",  name:"Ones",              value:1,        label:"1",          head:"--c-o-h",  tint:"--c-o-t"  },
  ];

  // ‚úÖ Embedded SVG raw (from your uploaded files)
  const SVG_ONE = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56.5 64">
  <defs>
    <style>
      .cls-1 {
        fill: #f7b12b;
      }

      .cls-2 {
        fill: #c97e00;
      }

      .cls-3 {
        fill: #e48f00;
      }

      .cls-4 {
        fill: #fff;
      }
    </style>
  </defs>
  <polygon class="cls-2" points="0 16 0 48 28.25 64 28.25 32 0 16"/>
  <polygon class="cls-3" points="28.25 0 0 16 28.25 32 56.5 16 28.25 0"/>
  <polygon class="cls-1" points="56.5 16 28.25 32 28.25 64 56.5 48 56.5 16"/>
  <polygon class="cls-4" points="28.25 33.15 1 17.73 1.5 16.86 28.25 32 55 16.86 55.5 17.73 28.25 33.15"/>
</svg>`;
  const SVG_TEN = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 39.18 206">
  <defs>
    <style>
      .cls-1 {
        fill: #30a5ff;
      }

      .cls-2 {
        fill: #1f66cc;
      }

      .cls-3 {
        fill: #1b8eea;
      }

      .cls-4 {
        fill: #fff;
      }
    </style>
  </defs>
  <polygon class="cls-2" points="0 10.3 0 195.7 19.59 206 19.59 20.6 0 10.3"/>
  <polygon class="cls-3" points="19.59 0 0 10.3 19.59 20.6 39.18 10.3 19.59 0"/>
  <polygon class="cls-1" points="39.18 10.3 19.59 20.6 19.59 206 39.18 195.7 39.18 10.3"/>
  <g>
    <polygon class="cls-4" points="19.59 21.74 1 11.95 1.46 11.06 19.59 20.6 37.72 11.06 38.18 11.95 19.59 21.74"/>
    <polygon class="cls-4" points="19.59 40.24 1 30.45 1.46 29.56 19.59 39.1 37.72 29.56 38.18 30.45 19.59 40.24"/>
    <polygon class="cls-4" points="19.59 58.74 1 48.95 1.46 48.06 19.59 57.6 37.72 48.06 38.18 48.95 19.59 58.74"/>
    <polygon class="cls-4" points="19.59 77.24 1 67.45 1.46 66.56 19.59 76.1 37.72 66.56 38.18 67.45 19.59 77.24"/>
    <polygon class="cls-4" points="19.59 95.74 1 85.95 1.46 85.06 19.59 94.6 37.72 85.06 38.18 85.95 19.59 95.74"/>
    <polygon class="cls-4" points="19.59 114.24 1 104.45 1.46 103.56 19.59 113.1 37.72 103.56 38.18 104.45 19.59 114.24"/>
    <polygon class="cls-4" points="19.59 132.74 1 122.95 1.46 122.06 19.59 131.6 37.72 122.06 38.18 122.95 19.59 132.74"/>
    <polygon class="cls-4" points="19.59 151.24 1 141.45 1.46 140.56 19.59 150.1 37.72 140.56 38.18 141.45 19.59 151.24"/>
    <polygon class="cls-4" points="19.59 169.74 1 159.95 1.46 159.06 19.59 168.6 37.72 159.06 38.18 159.95 19.59 169.74"/>
    <polygon class="cls-4" points="19.59 188.24 1 178.45 1.46 177.56 19.59 187.1 37.72 177.56 38.18 178.45 19.59 188.24"/>
  </g>
</svg>`;

  // ‚úÖ REPLACED with your uploaded hundred_base_ten_block.svg
  const SVG_HUNDRED = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 181.21 118.00">
<defs>
      <clipPath id="hundred-clip-top"><polygon points="90.60,4.00 177.21,54.00 90.60,104.00 4.00,54.00"/></clipPath>
      <clipPath id="hundred-clip-right"><polygon points="177.21,64.00 90.60,114.00 90.60,104.00 177.21,54.00"/></clipPath>
      <clipPath id="hundred-clip-left"><polygon points="4.00,64.00 90.60,114.00 90.60,104.00 4.00,54.00"/></clipPath>
    </defs>

    <!-- Faces -->
    <polygon points="4.00,64.00 90.60,114.00 90.60,104.00 4.00,54.00" fill="rgb(24,120,25)"/>
    <polygon points="177.21,64.00 90.60,114.00 90.60,104.00 177.21,54.00" fill="rgb(34,171,36)"/>
    <polygon points="90.60,4.00 177.21,54.00 90.60,104.00 4.00,54.00" fill="rgb(138,211,139)"/>

    <!-- Grid lines (clipped to each face) -->
    <path d="M 4.00 64.00 L 4.00 54.00 M 12.66 69.00 L 12.66 59.00 M 21.32 74.00 L 21.32 64.00 M 29.98 79.00 L 29.98 69.00 M 38.64 84.00 L 38.64 74.00 M 47.30 89.00 L 47.30 79.00 M 55.96 94.00 L 55.96 84.00 M 64.62 99.00 L 64.62 89.00 M 73.28 104.00 L 73.28 94.00 M 81.94 109.00 L 81.94 99.00 M 90.60 114.00 L 90.60 104.00 M 4.00 64.00 L 90.60 114.00 M 4.00 54.00 L 90.60 104.00" clip-path="url(#hundred-clip-left)" fill="none" stroke="#ffffff" stroke-width="1.2" stroke-linecap="round"/>
    <path d="M 177.21 64.00 L 177.21 54.00 M 168.54 69.00 L 168.54 59.00 M 159.88 74.00 L 159.88 64.00 M 151.22 79.00 L 151.22 69.00 M 142.56 84.00 L 142.56 74.00 M 133.90 89.00 L 133.90 79.00 M 125.24 94.00 L 125.24 84.00 M 116.58 99.00 L 116.58 89.00 M 107.92 104.00 L 107.92 94.00 M 99.26 109.00 L 99.26 99.00 M 90.60 114.00 L 90.60 104.00 M 177.21 64.00 L 90.60 114.00 M 177.21 54.00 L 90.60 104.00" clip-path="url(#hundred-clip-right)" fill="none" stroke="#ffffff" stroke-width="1.2" stroke-linecap="round"/>
    <path d="M 90.60 4.00 L 4.00 54.00 M 99.26 9.00 L 12.66 59.00 M 107.92 14.00 L 21.32 64.00 M 116.58 19.00 L 29.98 69.00 M 125.24 24.00 L 38.64 74.00 M 133.90 29.00 L 47.30 79.00 M 142.56 34.00 L 55.96 84.00 M 151.22 39.00 L 64.62 89.00 M 159.88 44.00 L 73.28 94.00 M 168.54 49.00 L 81.94 99.00 M 177.21 54.00 L 90.60 104.00 M 90.60 4.00 L 177.21 54.00 M 81.94 9.00 L 168.54 59.00 M 73.28 14.00 L 159.88 64.00 M 64.62 19.00 L 151.22 69.00 M 55.96 24.00 L 142.56 74.00 M 47.30 29.00 L 133.90 79.00 M 38.64 34.00 L 125.24 84.00 M 29.98 39.00 L 116.58 89.00 M 21.32 44.00 L 107.92 94.00 M 12.66 49.00 L 99.26 99.00 M 4.00 54.00 L 90.60 104.00" clip-path="url(#hundred-clip-top)" fill="none" stroke="#ffffff" stroke-width="1.2" stroke-linecap="round"/>

    <!-- Face outlines -->
    <polygon points="4.00,64.00 90.60,114.00 90.60,104.00 4.00,54.00" fill="none" stroke="#ffffff" stroke-width="1.68"/>
    <polygon points="177.21,64.00 90.60,114.00 90.60,104.00 177.21,54.00" fill="none" stroke="#ffffff" stroke-width="1.68"/>
    <polygon points="90.60,4.00 177.21,54.00 90.60,104.00 4.00,54.00" fill="none" stroke="#ffffff" stroke-width="1.68"/>
  
</svg>`;

  // ‚úÖ REPLACED with your uploaded thousand_base_ten_block.svg
  const SVG_THOUSAND = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 146.56 168.00">
<defs>
      <clipPath id="thousand-clip-top"><polygon points="73.28,4.00 142.56,44.00 73.28,84.00 4.00,44.00"/></clipPath>
      <clipPath id="thousand-clip-right"><polygon points="142.56,124.00 73.28,164.00 73.28,84.00 142.56,44.00"/></clipPath>
      <clipPath id="thousand-clip-left"><polygon points="4.00,124.00 73.28,164.00 73.28,84.00 4.00,44.00"/></clipPath>
    </defs>

    <!-- Faces -->
    <polygon points="4.00,124.00 73.28,164.00 73.28,84.00 4.00,44.00" fill="rgb(76,41,134)"/>
    <polygon points="142.56,124.00 73.28,164.00 73.28,84.00 142.56,44.00" fill="rgb(109,59,191)"/>
    <polygon points="73.28,4.00 142.56,44.00 73.28,84.00 4.00,44.00" fill="rgb(153,118,210)"/>

    <!-- Grid lines (clipped to each face) -->
    <path d="M 4.00 124.00 L 4.00 44.00 M 10.93 128.00 L 10.93 48.00 M 17.86 132.00 L 17.86 52.00 M 24.78 136.00 L 24.78 56.00 M 31.71 140.00 L 31.71 60.00 M 38.64 144.00 L 38.64 64.00 M 45.57 148.00 L 45.57 68.00 M 52.50 152.00 L 52.50 72.00 M 59.43 156.00 L 59.43 76.00 M 66.35 160.00 L 66.35 80.00 M 73.28 164.00 L 73.28 84.00 M 4.00 124.00 L 73.28 164.00 M 4.00 116.00 L 73.28 156.00 M 4.00 108.00 L 73.28 148.00 M 4.00 100.00 L 73.28 140.00 M 4.00 92.00 L 73.28 132.00 M 4.00 84.00 L 73.28 124.00 M 4.00 76.00 L 73.28 116.00 M 4.00 68.00 L 73.28 108.00 M 4.00 60.00 L 73.28 100.00 M 4.00 52.00 L 73.28 92.00 M 4.00 44.00 L 73.28 84.00" clip-path="url(#thousand-clip-left)" fill="none" stroke="#ffffff" stroke-width="1.0" stroke-linecap="round"/>
    <path d="M 142.56 124.00 L 142.56 44.00 M 135.64 128.00 L 135.64 48.00 M 128.71 132.00 L 128.71 52.00 M 121.78 136.00 L 121.78 56.00 M 114.85 140.00 L 114.85 60.00 M 107.92 144.00 L 107.92 64.00 M 100.99 148.00 L 100.99 68.00 M 94.07 152.00 L 94.07 72.00 M 87.14 156.00 L 87.14 76.00 M 80.21 160.00 L 80.21 80.00 M 73.28 164.00 L 73.28 84.00 M 142.56 124.00 L 73.28 164.00 M 142.56 116.00 L 73.28 156.00 M 142.56 108.00 L 73.28 148.00 M 142.56 100.00 L 73.28 140.00 M 142.56 92.00 L 73.28 132.00 M 142.56 84.00 L 73.28 124.00 M 142.56 76.00 L 73.28 116.00 M 142.56 68.00 L 73.28 108.00 M 142.56 60.00 L 73.28 100.00 M 142.56 52.00 L 73.28 92.00 M 142.56 44.00 L 73.28 84.00" clip-path="url(#thousand-clip-right)" fill="none" stroke="#ffffff" stroke-width="1.0" stroke-linecap="round"/>
    <path d="M 73.28 4.00 L 4.00 44.00 M 80.21 8.00 L 10.93 48.00 M 87.14 12.00 L 17.86 52.00 M 94.07 16.00 L 24.78 56.00 M 100.99 20.00 L 31.71 60.00 M 107.92 24.00 L 38.64 64.00 M 114.85 28.00 L 45.57 68.00 M 121.78 32.00 L 52.50 72.00 M 128.71 36.00 L 59.43 76.00 M 135.64 40.00 L 66.35 80.00 M 142.56 44.00 L 73.28 84.00 M 73.28 4.00 L 142.56 44.00 M 66.35 8.00 L 135.64 48.00 M 59.43 12.00 L 128.71 52.00 M 52.50 16.00 L 121.78 56.00 M 45.57 20.00 L 114.85 60.00 M 38.64 24.00 L 107.92 64.00 M 31.71 28.00 L 100.99 68.00 M 24.78 32.00 L 94.07 72.00 M 17.86 36.00 L 87.14 76.00 M 10.93 40.00 L 80.21 80.00 M 4.00 44.00 L 73.28 84.00" clip-path="url(#thousand-clip-top)" fill="none" stroke="#ffffff" stroke-width="1.0" stroke-linecap="round"/>

    <!-- Face outlines -->
    <polygon points="4.00,124.00 73.28,164.00 73.28,84.00 4.00,44.00" fill="none" stroke="#ffffff" stroke-width="1.4"/>
    <polygon points="142.56,124.00 73.28,164.00 73.28,84.00 142.56,44.00" fill="none" stroke="#ffffff" stroke-width="1.4"/>
    <polygon points="73.28,4.00 142.56,44.00 73.28,84.00 4.00,44.00" fill="none" stroke="#ffffff" stroke-width="1.4"/>
  
</svg>`;

  let __svgSeq = 0;
  function uniquifySvgIds(svgText, prefix){
    __svgSeq += 1;
    const suf = `${prefix}__${__svgSeq}`;
    return svgText
      .replace(/\bid="([^"]+)"/g, (m, id) => `id="${id}__${suf}"`)
      .replace(/url\(#([^)]+)\)/g, (m, id) => `url(#${id}__${suf})`);
  }

  function blockSVG(placeKey){
    if (placeKey === "o")  return uniquifySvgIds(SVG_ONE, "one");
    if (placeKey === "t")  return uniquifySvgIds(SVG_TEN, "ten");
    if (placeKey === "h")  return uniquifySvgIds(SVG_HUNDRED, "hundred");
    if (placeKey === "th") return uniquifySvgIds(SVG_THOUSAND, "thousand");
    return "";
  }
  function blockClass(placeKey){
    if (placeKey === "o") return "one";
    if (placeKey === "t") return "ten";
    if (placeKey === "h") return "hundred";
    if (placeKey === "th") return "thousand";
    return "one";
  }
  function pileClass(placeKey){
    if (placeKey === "o") return "ones";
    if (placeKey === "t") return "rods";
    if (placeKey === "h") return "flats";
    if (placeKey === "th") return "cubes";
    return "";
  }

  // discs color helpers
  function hexToRgb(hex){
    const m = hex.trim().match(/^#?([0-9a-f]{6})$/i);
    if (!m) return {r:0,g:0,b:0};
    const n = parseInt(m[1], 16);
    return { r:(n>>16)&255, g:(n>>8)&255, b:n&255 };
  }
  function rgbToHex(r,g,b){
    const clamp=v=>Math.max(0,Math.min(255,Math.round(v)));
    return "#" + [clamp(r),clamp(g),clamp(b)].map(v=>v.toString(16).padStart(2,"0")).join("");
  }
  function mix(hexA, hexB, t){
    const a=hexToRgb(hexA), b=hexToRgb(hexB);
    return rgbToHex(a.r+(b.r-a.r)*t, a.g+(b.g-a.g)*t, a.b+(b.b-a.b)*t);
  }
  function darken(hex, amt){ return mix(hex, "#000000", amt); }
  function lighten(hex, amt){ return mix(hex, "#ffffff", amt); }

  function discBaseColor(placeKey){
    if (placeKey === "o")  return "#11a7e6";
    if (placeKey === "t")  return "#f4a11c";
    if (placeKey === "h")  return "#f58ab4";
    if (placeKey === "th") return "#32b44a";
    if (placeKey === "tt") return "#ef4444";
    if (placeKey === "ht") return "#2563eb";
    if (placeKey === "m")  return "#7c3aed";
    if (placeKey === "tm") return "#0b2a6a"; // ‚úÖ very dark blue
    return "#64748b";
  }
  function discHTML(place){
    const base = discBaseColor(place.key);
    const rim  = darken(base, 0.22);
    const top  = lighten(base, 0.18);
    const bot  = darken(base, 0.10);
    const fill = `linear-gradient(180deg, ${top} 0%, ${base} 55%, ${bot} 100%)`;
    return `<div class="disc" style="--disc-fill:${fill}; --disc-rim:${rim};">${place.value}</div>`;
  }

  // card digit fit helper
  function cardSizing(len){
  if (len <= 4) return { fs: 26, gap: 14, minw: 0.90 };
  if (len === 5) return { fs: 24, gap: 12, minw: 0.88 };
  if (len === 6) return { fs: 22, gap: 10, minw: 0.84 };
  if (len === 7) return { fs: 18, gap: 6,  minw: 0.78 }; // ‚úÖ 9,000,000 fits
  return            { fs: 16, gap: 5,  minw: 0.74 };     // ‚úÖ 10,000,000 fits
}


  // UI
  const panelGrid = $("panelGrid");
  const chartHead = $("chartHead");
  const chartDigits = $("chartDigits");
  const numRead = $("numRead");
  const modeRead = $("modeRead");
  const modeBadge = $("modeBadge");

  const openSettings = $("openSettings");
  const closeSettings = $("closeSettings");
  const drawer = $("drawer");
  const backdrop = $("backdrop");

  const numInput = $("numInput");
  const size = $("size");
  const sizeNote = $("sizeNote");

  const btnBlocks = $("btnBlocks");
  const btnDiscs = $("btnDiscs");

  const apply = $("apply");
  const clearBtn = $("clear");
  const randSmall = $("randSmall");
  const randBig = $("randBig");

  const toast = $("toast");

  const cardsArea = $("cardsArea");
  const cardsApart = $("cardsApart");
  const cardsTogether = $("cardsTogether");
  const wordsLine = $("wordsLine");
  const expLine = $("expLine");
  const btnApart = $("btnApart");
  const btnTogether = $("btnTogether");
  const btnToggleCards = $("btnToggleCards");
  const btnToggleExpanded = $("btnToggleExpanded");
const chartWrap = $("chartWrap");
const toggleChart = $("toggleChart");

let chartVisible = true;
function applyChartVisibility(){
  chartWrap.style.display = chartVisible ? "block" : "none";
  toggleChart.textContent = chartVisible ? "üìä" : "üìà";
  toggleChart.title = chartVisible ? "Hide Chart" : "Show Chart";
}
toggleChart.addEventListener("click", () => {
  chartVisible = !chartVisible;
  applyChartVisibility();
  requestAnimationFrame(() => fitAllPanels());
});


  let cardsVisible = true;
  let expandedVisible = true;
  let cardsView = "apart";
  let preferredMode = "auto";
  let toastTimer = null;

  function clampInt(n, min, max){
    n = parseInt(n,10);
    if (!Number.isFinite(n)) n = 0;
    return Math.max(min, Math.min(max, Math.floor(n)));
  }
  function comma(n){ return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); }
  function digitsFor(n){
    const out = {};
    for (const p of PLACES) out[p.key] = Math.floor(n / p.value) % 10;
    return out;
  }
  function activePlaces(digs){
    let first = PLACES.findIndex(p => digs[p.key] !== 0);
    if (first === -1) first = PLACES.length - 1;
    return PLACES.slice(first);
  }
  function effectiveMode(n){
    if (n >= 10000) return "discs"; // ‚úÖ 10,000 uses discs
    if (preferredMode === "discs") return "discs";
    if (preferredMode === "blocks") return "blocks";
    return "blocks";
  }
  function showToast(msg){
    if (toastTimer) return;
    toast.textContent = msg;
    toast.style.display = "block";
    toastTimer = setTimeout(() => {
      toast.style.display = "none";
      toastTimer = null;
    }, 1600);
  }

  function fitAllPanels(){
    const stages = panelGrid.querySelectorAll(".pvStage");
    stages.forEach(stage => {
      const box = stage.querySelector(".fitBox");
      if (!box) return;
      box.style.transform = "scale(1)";
      const availW = stage.clientWidth;
      const availH = stage.clientHeight;
      if (availW < 10 || availH < 10) return;
      const contentW = box.scrollWidth;
      const contentH = box.scrollHeight;
      if (contentW < 1 || contentH < 1) return;
      const scale = Math.min(1, (availW / contentW), (availH / contentH));
      box.style.transform = `scale(${scale})`;
    });
  }

  // number words (Singapore textbook feel)
  const ONES = ["zero","one","two","three","four","five","six","seven","eight","nine"];
  const TEENS = ["ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"];
  const TENSW = ["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];

  function wordsUnder100(n){
    if (n < 10) return ONES[n];
    if (n < 20) return TEENS[n-10];
    const t = Math.floor(n/10), o = n%10;
    return o ? `${TENSW[t]}-${ONES[o]}` : TENSW[t];
  }
  function wordsUnder1000(n){
    const h = Math.floor(n/100), r = n%100;
    if (!h) return wordsUnder100(r);
    if (!r) return `${ONES[h]} hundred`;
    return `${ONES[h]} hundred and ${wordsUnder100(r)}`;
  }

  // ‚úÖ up to 10,000,000 only
  // ‚úÖ commas between groups, but NO comma before "and" (when final remainder < 100)
  function numberToWords(n){
    if (n === 0) return "zero";
    if (n < 1000) return wordsUnder1000(n);
    if (n === 10000000) return "ten million";

    const tm = Math.floor(n / 10000000); // 0..1
    const remTM = n % 10000000;

    const m = Math.floor(remTM / 1000000); // 0..9
    const remM = remTM % 1000000;

    const th = Math.floor(remM / 1000); // 0..999
    const last = remM % 1000;           // 0..999

    const major = [];
    if (tm) major.push("ten million");
    if (m)  major.push(`${wordsUnder1000(m)} million`);
    if (th) major.push(`${wordsUnder1000(th)} thousand`);

    if (last === 0) return major.join(", ");
    const majorText = major.join(", ");

    if (!majorText) return wordsUnder1000(last);

    if (last < 100) return `${majorText} and ${wordsUnder100(last)}`;
    return `${majorText}, ${wordsUnder1000(last)}`;
  }

  function placeLabel(placeKey, digit){
    const base = { tm:"ten million", m:"million", ht:"hundred thousand", tt:"ten thousand", th:"thousand", h:"hundred", t:"ten", o:"one" }[placeKey] || placeKey;
    const plural = (digit === 1) ? base : (base === "one" ? "ones" : base + "s");
    return `${digit} ${plural}`;
  }
  function zerosCount(placeKey){
    return { tm:7, m:6, ht:5, tt:4, th:3, h:2, t:1, o:0 }[placeKey] ?? 0;
  }
  function placeFill(placeKey){
    const base = discBaseColor(placeKey);
    const rim  = darken(base, 0.18);
    const top  = lighten(base, 0.14);
    const bot  = darken(base, 0.08);
    return { bg: `linear-gradient(180deg, ${top} 0%, ${base} 60%, ${bot} 100%)`, border: rim };
  }

  function renderCardsWordsExpanded(n, digs, act){
    cardsApart.innerHTML = "";
    cardsTogether.innerHTML = "";

    const nonZeroAct = act.filter(p => digs[p.key] !== 0);

    nonZeroAct.forEach(place => {
      const digit = digs[place.key];
      const z = zerosCount(place.key);
      const txt = String(digit) + ("0".repeat(z));
      const len = txt.length;
      const {bg,border} = placeFill(place.key);
      const {fs, gap, minw} = cardSizing(len);
      const spans = txt.split("").map(ch => `<span>${ch}</span>`).join("");

      const item = document.createElement("div");
      item.className = "apartItem";
      item.innerHTML = `
        <div class="cap">${placeLabel(place.key, digit)}</div>
        <div class="pvCard" style="background:${bg}; border-color:${border}; --pv-fs:${fs}px; --pv-gap:${gap}px; --pv-minw:${minw}em;">
          <div class="digits">${spans}</div>
        </div>
      `;
      cardsApart.appendChild(item);
    });

    const join = document.createElement("div");
    join.className = "joinCard";
    act.forEach(place => {
      const {bg} = placeFill(place.key);
      const seg = document.createElement("div");
      seg.className = "joinSeg";
      seg.style.background = bg;
      seg.textContent = digs[place.key];
      join.appendChild(seg);
    });
    cardsTogether.appendChild(join);

    const words = numberToWords(n);
    wordsLine.textContent = words.charAt(0).toUpperCase() + words.slice(1);

    if (n === 0){
      expLine.innerHTML = `0<small>Expanded form</small>`;
      return;
    }
    const terms = [];
    act.forEach(place => {
      const d = digs[place.key];
      if (!d) return;
      terms.push(comma(d * place.value));
    });
    expLine.innerHTML = `${terms.join(" + ")} = ${comma(n)}<small>Expanded form</small>`;
  }

  function renderCardsView(){
    btnApart.classList.toggle("active", cardsView === "apart");
    btnTogether.classList.toggle("active", cardsView === "together");
    cardsApart.style.display = (cardsView === "apart") ? "flex" : "none";
    cardsTogether.style.display = (cardsView === "together") ? "flex" : "none";
  }
  function applyCardsVisibility(){
    cardsArea.style.display = cardsVisible ? "grid" : "none";
    btnToggleCards.textContent = cardsVisible ? "Hide Cards" : "Show Cards";
    wordsLine.style.display = expandedVisible ? "block" : "none";
    expLine.style.display   = expandedVisible ? "block" : "none";
    btnToggleExpanded.textContent = expandedVisible ? "Hide Expanded" : "Show Expanded";
  }

  function render(){
    let raw = parseInt(numInput.value, 10);
    if (!Number.isFinite(raw)) raw = 0;

    if (raw > 10000000) {
      raw = 10000000;
      showToast("Max is 10,000,000.");
    }
    if (raw < 0) raw = 0;

    const n = raw;
    numInput.value = n;

    const digs = digitsFor(n);
    const act = activePlaces(digs);
    const mode = effectiveMode(n);

    document.documentElement.style.setProperty("--cols", Math.min(act.length, 8));

    numRead.textContent = comma(n);
    modeRead.textContent = mode === "blocks" ? "Blocks" : "Discs";
    modeBadge.textContent =
      (n >= 10000) ? "Auto ‚Üí Discs ( ‚â•10,000 )"
      : (preferredMode === "auto" ? "Auto" : (preferredMode === "blocks" ? "Manual: Blocks" : "Manual: Discs"));

    const blocksAllowed = (n < 10000);
    btnBlocks.disabled = !blocksAllowed;
    btnBlocks.classList.toggle("active", preferredMode === "blocks" && blocksAllowed);
    btnDiscs.classList.toggle("active", preferredMode === "discs");

    if (preferredMode === "blocks" && n >= 10000){
      showToast("Number ‚â• 10,000 ‚Üí switching to Discs automatically.");
    }

    // panels
    panelGrid.innerHTML = "";
    act.forEach(place => {
      const digit = digs[place.key];

      const panel = document.createElement("div");
      panel.className = "pvPanel";
      panel.style.background = getComputedStyle(document.documentElement).getPropertyValue(place.tint).trim();

      const label = document.createElement("div");
      label.className = "pvLabel";
      label.textContent = place.name;

      const stage = document.createElement("div");
      stage.className = "pvStage";

      const box = document.createElement("div");
      box.className = "fitBox";

      if (mode === "blocks" && ["th","h","t","o"].includes(place.key)){
        const pile = document.createElement("div");
        pile.className = "pile " + pileClass(place.key);
        for (let i=0; i<digit; i++){
          const blk = document.createElement("div");
          blk.className = `blk ${blockClass(place.key)}`;
          blk.innerHTML = blockSVG(place.key);
          pile.appendChild(blk);
        }
        box.appendChild(pile);
      } else {
        const stack = document.createElement("div");
        stack.className = "discStack";
        for (let i=0; i<digit; i++){
          const w = document.createElement("div");
          w.innerHTML = discHTML(place);
          stack.appendChild(w.firstElementChild);
        }
        box.appendChild(stack);
      }

      stage.appendChild(box);
      panel.appendChild(label);
      panel.appendChild(stage);
      panelGrid.appendChild(panel);
    });

    // chart
    chartHead.innerHTML = "";
    chartDigits.innerHTML = "";
    act.forEach(place => {
      const h = document.createElement("div");
      h.className = "cell";
      h.style.background = getComputedStyle(document.documentElement).getPropertyValue(place.head).trim();
      h.textContent = place.name;
      chartHead.appendChild(h);

      const d = document.createElement("div");
      d.className = "cell";
      d.textContent = digs[place.key];
      chartDigits.appendChild(d);
    });

    renderCardsWordsExpanded(n, digs, act);
    renderCardsView();
    applyCardsVisibility();

    requestAnimationFrame(() => fitAllPanels());
  }

  // drawer
  function openDrawer(){
    drawer.classList.add("open");
    backdrop.classList.add("open");
    drawer.setAttribute("aria-hidden","false");
  }
  function closeDrawer(){
    drawer.classList.remove("open");
    backdrop.classList.remove("open");
    drawer.setAttribute("aria-hidden","true");
  }
  openSettings.addEventListener("click", openDrawer);
  closeSettings.addEventListener("click", closeDrawer);
  backdrop.addEventListener("click", closeDrawer);

  // mode buttons
  btnDiscs.addEventListener("click", () => { preferredMode = "discs"; render(); });
  btnBlocks.addEventListener("click", () => {
    const n = clampInt(numInput.value, 0, 10000000);
    if (n < 10000){ preferredMode = "blocks"; render(); }
    else showToast("Blocks only available when number < 10,000.");
  });

  // cards view buttons
  btnApart.addEventListener("click", () => { cardsView = "apart"; renderCardsView(); });
  btnTogether.addEventListener("click", () => { cardsView = "together"; renderCardsView(); });

  btnToggleCards.addEventListener("click", () => {
    cardsVisible = !cardsVisible;
    if (!cardsVisible) expandedVisible = true;
    applyCardsVisibility();
    requestAnimationFrame(() => fitAllPanels());
  });
  btnToggleExpanded.addEventListener("click", () => {
    expandedVisible = !expandedVisible;
    applyCardsVisibility();
    requestAnimationFrame(() => fitAllPanels());
  });

  // settings actions
  apply.addEventListener("click", () => { render(); closeDrawer(); });
  clearBtn.addEventListener("click", () => { numInput.value = 0; preferredMode = "auto"; render(); });
  randSmall.addEventListener("click", () => { numInput.value = Math.floor(Math.random()*10000); preferredMode="auto"; render(); });
  randBig.addEventListener("click", () => { numInput.value = Math.floor(Math.random()*10000001); preferredMode="auto"; render(); });
  numInput.addEventListener("input", render);

  // size slider
  size.addEventListener("input", () => {
    const v = clampInt(size.value, 9, 16);
    document.documentElement.style.setProperty("--S", v + "px");
    sizeNote.innerHTML = `Current base size: ${v}<br>Blocks/discs may auto-shrink further to fit panels.`;
    render();
  });

  document.documentElement.style.setProperty("--S", clampInt(size.value,9,16) + "px");
  preferredMode = "auto";
  render();
  applyChartVisibility();

  window.addEventListener("resize", () => requestAnimationFrame(() => fitAllPanels()));
})();
</script>
</body>
</html>
```
